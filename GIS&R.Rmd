---
title: "GIS_&_R"
author: Caleb Malay 
output: html_document
---

#Installs necessary packages for this exercise and loads them.
```{r}
install.packages(c("sf", "sp", "GADMTools", "tidyverse", "units", "rmapshaper"))
library(sf)
library(sp)
library(GADMTools)
library(tidyverse)
library(units)
library(rmapshaper)
```

#Reads in the shapefile.
```{r}
My_SF <- st_read("india_states_2014/india_states.shp")
```

#Downloads shapefiles for Indian states. 
```{r}
India_wrapper <- gadm_sp_loadCountries("IND", level = 1, basefile = "./attributes.rds")
```

#Converts sf object to a Spatial Polygons Data Frame.
```{r}
spdf <- as(sf, "Spatial")
```

#Converts spdf object back to a sf object.
```{r}
India_sf <- st_as_sf(spdf)
```

#Assigns these country names to a variable.
```{r}
Union_Terr <- c("Delhi", "Andaman & Nicobar Islands", "Puducherry",
"Lakshadweep")
```

#Selects and renames the country names above. 
```{r}
India_sf <- India_sf %>%
  select(name, abbr) %>%
  mutate(
    type = ifelse(name %in% Union_Terr, "Union Territory", "State")
  )%>%
  rename(abb = abbr, state_ut = name)
```


#Joins the spatial dataframe and the attribute dataframe. Then creates two new variables. 
```{r}
Attribute_df <- readRDS("attributes.rds")
India_sf <- India_sf %>%
  left_join(Attribute_df, by = "state_ut")%>%
  mutate(
    pc_gdp_inr = nominal_gdp_inr / pop_2011,
    pc_gdp_usd = nominal_gdp_usd / pop_2011
  )
```

#Calculates area for each observation. 
```{r}
India_sf <- India_sf %>%
  mutate(My_Area = st_area(.))
```

#Converts units from sq meters to sq kilometers. 
```{r}
units(India_sf$My_Area) <- with(ud_units, km^2)
```

#Creates a new variable for gdp density. 
```{r}
India_sf <- India_sf %>% 
  mutate(gdp_density_usd = nominal_gdp_usd / My_Area)
```

#Removes the unit class. 
```{r}
India_sf <- India_sf %>%
  mutate(
    My_Area = as.vector(My_Area),
    gdp_density_usd = as.vector(gdp_density_usd)
  )
```

#Simplifies the geometry. Keeps 1 percent of the vertices of the original.
```{r}
original_geom <- st_geometry(India_sf)
Simple_sf <- ms_simplify(India_sf, keep = 0.01, keep_shapes = TRUE)
simple_geom <- st_geometry(Simple_sf)
```

#Plots original and simplified geometries. 
```{r}
par(mfrow = c(1,2))
plot(original_geom, main = "Original Geometry")
plot(simple_geom, main = "Simplified Geometry")
```

#Saves the simplified dataframe.
```{r}
saveRDS(Simple_sf, "Simple_sf.rds")
```

#Plots data for visualization using the 2011 population. 
```{r}
Simple_sf <- readRDS("./Simple_sf.rds")
plot(Simple_sf['pc_gdp_inr'], main= "GDP Per Capita of India, 2011")
```
